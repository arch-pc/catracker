<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievement Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .main-layout {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .achievements-content {
            flex: 1;
            min-width: 0;
        }

        .sidebar {
            flex: 0 0 320px;
            position: sticky;
            top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #495057;
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            color: #495057;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transform: translateY(0);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid #e9ecef;
        }

        .stat-card.compact {
            padding: 15px;
        }

        .stat-card.compact .stat-number {
            font-size: 1.5rem;
        }

        .stat-card.compact .stat-label {
            font-size: 0.85rem;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .milestones {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .milestones h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
        }

        .milestone-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .milestone-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
            color: #495057;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: left;
        }

        .milestone-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .milestone-btn.achieved {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .milestone-btn.achieved:hover {
            background: #c3e6cb;
        }

        .milestone-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .milestone-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }

        .milestone-name {
            font-weight: 600;
            font-size: 0.8rem;
        }

        .milestone-points {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .milestone-remaining {
            font-size: 0.7rem;
            color: #dc3545;
            font-weight: 500;
        }

        .file-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            color: #6c757d;
        }

        .load-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .load-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .category {
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid #e9ecef;
        }

        .category-header {
            padding: 15px 20px;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .category-header:hover {
            filter: brightness(1.1);
        }

        .category-header::after {
            content: '▼';
            transition: transform 0.2s ease;
        }

        .category-header.collapsed::after {
            transform: rotate(-90deg);
        }

        .category-header-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-icon {
            width: 24px;
            height: 24px;
        }

        .category-content {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .category-content.collapsed {
            max-height: 0;
        }

        .easy { background: #28a745; }
        .medium { background: #fd7e14; }
        .hard { background: #dc3545; }
        .elite { background: #6f42c1; }
        .master { background: #343a40; }
        .grandmaster { background: #ffc107; color: #212529; }

        .achievement {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .achievement:last-child {
            border-bottom: none;
        }

        .achievement:hover {
            background: #f8f9fa;
        }

        .achievement.done {
            background: #f8f9fa;
            opacity: 0.7;
        }

        .achievement-info {
            flex: 1;
            margin-right: 20px;
        }

        .achievement-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #343a40;
            margin-bottom: 5px;
        }

        .achievement-description {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .achievement-requirements {
            color: #17a2b8;
            font-size: 0.85rem;
            margin-bottom: 5px;
            font-style: italic;
            background: #e8f4f8;
            padding: 4px 8px;
            border-radius: 4px;
            border-left: 3px solid #17a2b8;
        }

        .achievement-meta {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            color: #adb5bd;
        }

        .achievement-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }

        .btn-todo {
            background: #ffc107;
            color: #333;
        }

        .btn-todo:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-done {
            background: #28a745;
            color: white;
        }

        .btn-reset {
            background: #6c757d;
            color: white;
        }

        .btn-reset:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        .boss-filters {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .boss-filters h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
        }

        .boss-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .boss-btn {
            padding: 8px 6px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            color: #495057;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .boss-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .boss-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .boss-btn.active:hover {
            background: #0056b3;
            border-color: #0056b3;
        }

        .filter-control-btn {
            padding: 6px 16px;
            border: 1px solid #007bff;
            border-radius: 4px;
            background: white;
            color: #007bff;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s ease;
            flex: 1;
        }

        .filter-control-btn:hover {
            background: #007bff;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏆 Achievement Tracker</h1>
        </div>

        <div class="file-input" id="loadingStatus">
            <div>📄 Loading achievements.json...</div>
        </div>

        <div class="main-layout">
            <div class="achievements-content">
                <div id="achievementsContainer">
                    <div class="empty-state">
                        🔍 Loading your achievements.json file...
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="stats">
                    <div class="stat-card compact">
                        <div class="stat-number" id="currentPoints">0</div>
                        <div class="stat-label">Current Points</div>
                    </div>
                    <div class="stat-card compact">
                        <div class="stat-number" id="totalIncludingTodo">0</div>
                        <div class="stat-label">Including To Do</div>
                    </div>
                </div>

                <div class="milestones">
                    <h3>Milestones</h3>
                    <div class="milestone-grid" id="milestoneGrid"></div>
                </div>

                <div id="bossFilters" class="boss-filters" style="display: none;">
                    <h3>Boss Filters</h3>
                    <div class="filter-controls" style="margin-bottom: 12px; display: flex; gap: 8px;">
                        <button class="filter-control-btn" onclick="setAllBossFilters(true)">Show All</button>
                        <button class="filter-control-btn" onclick="setAllBossFilters(false)">Show None</button>
                    </div>
                    <div id="bossButtons" class="boss-buttons"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let achievements = {};
        let achievementStates = {};
        let bossFilters = {};
        let categoryCollapsed = {};

        const categoryPoints = {
            easy: 1,
            medium: 2,
            hard: 3,
            elite: 4,
            master: 5,
            grandmaster: 6
        };

        const categoryNames = {
            easy: 'Easy',
            medium: 'Medium', 
            hard: 'Hard',
            elite: 'Elite',
            master: 'Master',
            grandmaster: 'Grandmaster'
        };

        const categoryIcons = {
            easy: 'https://oldschool.runescape.wiki/images/Combat_Achievements_-_easy_tier_icon.png',
            medium: 'https://oldschool.runescape.wiki/images/Combat_Achievements_-_medium_tier_icon.png',
            hard: 'https://oldschool.runescape.wiki/images/Combat_Achievements_-_hard_tier_icon.png',
            elite: 'https://oldschool.runescape.wiki/images/Combat_Achievements_-_elite_tier_icon.png',
            master: 'https://oldschool.runescape.wiki/images/Combat_Achievements_-_master_tier_icon.png',
            grandmaster: 'https://oldschool.runescape.wiki/images/Combat_Achievements_-_grandmaster_tier_icon.png'
        };

        const milestones = {
            easy: 38,
            medium: 148,
            hard: 394,
            elite: 1026,
            master: 1841,
            grandmaster: 2525
        };

        const bossCategories = [
            'Sire', 'Hydra', 'Amoxliatl', 'Araxxor', 'Barrows', 'Bryophyta', 
            'Callisto', 'Cerberus', 'CoX', 'CoX:CM', 'Chaos Ele', 'Chaos Fanatic',
            'Zilyana', 'Corp', 'Corr Gauntlet', 'Gauntlet', 'Dagga Kings', 
            'Deranged Arch', 'Duke', 'Colloseum', 'Graardor', 'Mole', 'Grotesques',
            'Hespori', 'K\'ril', 'KQ', 'KBD', 'Kraken', 'Kree\'arra', 'Leviathan',
            'Moons', 'Nex', 'Obor', 'Muspah', 'Phosani', 'Royal Titans', 'Sarachnis',
            'Scorpia', 'Scurrius', 'Skotizo', 'Tempoross', 'Huey', 'Nightmare',
            'ToB', 'ToB:Entry', 'ToB:HM', 'Thermy', 'ToA', 'ToA:Entry', 'ToA:Expert',
            'Zuk', 'Jad', 'Tzhaar challenge', 'Vardorvis', 'Venenatis', 'Vet\'ion',
            'Vorkath', 'Whisperer', 'Wintertodt', 'Yama', 'Zalcano', 'Zulrah',
            'Quest bosses', 'Misc'
        ];

        async function loadAchievementsFromFile() {
            // Load saved data first
            loadSavedData();
            
            try {
                const response = await fetch('./achievements.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                achievements = await response.json();
                setupBossFilters();
                setupMilestones();
                renderAchievements();
                updateStats();
                
                document.getElementById('loadingStatus').style.display = 'none';
            } catch (error) {
                console.error('Error loading achievements.json:', error);
                document.getElementById('loadingStatus').innerHTML = `
                    <div style="color: #e74c3c;">
                        ❌ Cannot load achievements.json: ${error.message}<br>
                        <small>Make sure achievements.json is in the same folder as this HTML file.</small>
                    </div>
                `;
            }
        }

        window.addEventListener('load', loadAchievementsFromFile);

        function setupBossFilters() {
            const allBosses = new Set();
            
            Object.keys(achievements).forEach(category => {
                if (achievements[category]) {
                    achievements[category].forEach(achievement => {
                        if (achievement.monster) {
                            allBosses.add(achievement.monster);
                        }
                    });
                }
            });

            // Only include bosses that are in our predefined list
            const filteredBosses = new Set();
            allBosses.forEach(boss => {
                if (bossCategories.includes(boss)) {
                    filteredBosses.add(boss);
                }
            });

            // Initialize boss filters (use saved data if available, otherwise default to true)
            filteredBosses.forEach(boss => {
                if (!(boss in bossFilters)) {
                    bossFilters[boss] = true;
                }
            });

            // Initialize category collapsed states (use saved data if available, otherwise default to true)
            Object.keys(categoryPoints).forEach(category => {
                if (!(category in categoryCollapsed)) {
                    categoryCollapsed[category] = true;
                }
            });

            const bossButtonsContainer = document.getElementById('bossButtons');
            const bossFiltersContainer = document.getElementById('bossFilters');
            
            if (filteredBosses.size > 0) {
                bossFiltersContainer.style.display = 'block';
                bossButtonsContainer.innerHTML = '';
                
                // Sort according to our predefined order
                const sortedBosses = bossCategories.filter(boss => filteredBosses.has(boss));
                
                sortedBosses.forEach(boss => {
                    const button = document.createElement('button');
                    button.className = `boss-btn ${bossFilters[boss] ? 'active' : ''}`;
                    button.textContent = boss;
                    button.title = boss;
                    button.onclick = () => toggleBossFilter(boss);
                    bossButtonsContainer.appendChild(button);
                });
            }
        }

        function setupMilestones() {
            const milestoneGrid = document.getElementById('milestoneGrid');
            milestoneGrid.innerHTML = '';

            Object.keys(milestones).forEach(tier => {
                const button = document.createElement('button');
                button.className = 'milestone-btn';
                button.onclick = () => toggleMilestoneInfo(tier, button);
                
                button.innerHTML = `
                    <img src="${categoryIcons[tier]}" alt="${tier}" class="milestone-icon">
                    <div class="milestone-text">
                        <div class="milestone-name">${categoryNames[tier]}</div>
                        <div class="milestone-points">${milestones[tier]} pts</div>
                    </div>
                `;
                
                milestoneGrid.appendChild(button);
            });
        }

        function toggleMilestoneInfo(tier, button) {
            const currentPoints = getCurrentPoints();
            const milestonePoints = milestones[tier];
            const remaining = Math.max(0, milestonePoints - currentPoints);
            
            // Remove any existing remaining text from all buttons
            document.querySelectorAll('.milestone-remaining').forEach(el => el.remove());
            
            if (remaining > 0) {
                const remainingDiv = document.createElement('div');
                remainingDiv.className = 'milestone-remaining';
                remainingDiv.textContent = `Need ${remaining} more`;
                button.querySelector('.milestone-text').appendChild(remainingDiv);
            }
            
            // Remove the text after 3 seconds
            setTimeout(() => {
                const remainingEl = button.querySelector('.milestone-remaining');
                if (remainingEl) remainingEl.remove();
            }, 3000);
        }

        function getCurrentPoints() {
            let currentPoints = 0;
            Object.keys(achievements).forEach(category => {
                if (achievements[category]) {
                    achievements[category].forEach((achievement, index) => {
                        if (achievement.monster && bossFilters[achievement.monster] !== true) {
                            return;
                        }
                        const achievementId = `${category}-${index}`;
                        const state = achievementStates[achievementId];
                        if (state === 'done') {
                            currentPoints += categoryPoints[category];
                        }
                    });
                }
            });
            return currentPoints;
        }

        function updateMilestoneStates() {
            const currentPoints = getCurrentPoints();
            document.querySelectorAll('.milestone-btn').forEach((btn, index) => {
                const tier = Object.keys(milestones)[index];
                const milestonePoints = milestones[tier];
                
                if (currentPoints >= milestonePoints) {
                    btn.classList.add('achieved');
                } else {
                    btn.classList.remove('achieved');
                }
            });
        }

        function toggleBossFilter(boss) {
            bossFilters[boss] = !bossFilters[boss];
            
            const buttons = document.querySelectorAll('.boss-btn');
            buttons.forEach(btn => {
                if (btn.title === boss || btn.textContent === boss) {
                    if (bossFilters[boss]) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                }
            });
            
            renderAchievements();
            updateStats();
            saveData(); // Save filter changes
        }

        function toggleCategory(category) {
            categoryCollapsed[category] = !categoryCollapsed[category];
            
            const header = document.querySelector(`[data-category="${category}"] .category-header`);
            const content = document.querySelector(`[data-category="${category}"] .category-content`);
            
            if (categoryCollapsed[category]) {
                header.classList.add('collapsed');
                content.classList.add('collapsed');
                content.style.maxHeight = '0px';
            } else {
                header.classList.remove('collapsed');
                content.classList.remove('collapsed');
                content.style.maxHeight = content.scrollHeight + 'px';
                
                setTimeout(() => {
                    if (!categoryCollapsed[category]) {
                        content.style.maxHeight = 'none';
                    }
                }, 300);
            }
            
            saveData(); // Save collapsed state changes
        }

        function renderAchievements() {
            const container = document.getElementById('achievementsContainer');
            container.innerHTML = '';

            Object.keys(categoryPoints).forEach(category => {
                if (achievements[category] && achievements[category].length > 0) {
                    const filteredAchievements = achievements[category].filter(achievement => {
                        return !achievement.monster || bossFilters[achievement.monster] === true;
                    });

                    if (filteredAchievements.length > 0) {
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'category';
                        categoryDiv.setAttribute('data-category', category);
                        
                        const isCollapsed = categoryCollapsed[category];
                        
                        categoryDiv.innerHTML = `
                            <div class="category-header ${category} ${isCollapsed ? 'collapsed' : ''}" 
                                 onclick="toggleCategory('${category}')">
                                <div class="category-header-content">
                                    <img src="${categoryIcons[category]}" alt="${category}" class="category-icon">
                                    <span>${categoryNames[category]} (${categoryPoints[category]} point${categoryPoints[category] > 1 ? 's' : ''})</span>
                                </div>
                            </div>
                            <div class="category-content ${isCollapsed ? 'collapsed' : ''}" 
                                 style="max-height: ${isCollapsed ? '0px' : 'none'}">
                            </div>
                        `;

                        const contentDiv = categoryDiv.querySelector('.category-content');

                        achievements[category].forEach((achievement, index) => {
                            if (achievement.monster && bossFilters[achievement.monster] !== true) {
                                return;
                            }

                            const achievementId = `${category}-${index}`;
                            const state = achievementStates[achievementId] || 'none';
                            
                            const achievementDiv = document.createElement('div');
                            achievementDiv.className = `achievement ${state === 'done' ? 'done' : ''}`;
                            
                            let requirementsHTML = '';
                            if (achievement.requirements) {
                                requirementsHTML = `<div class="achievement-requirements">Requirements: ${achievement.requirements}</div>`;
                            }
                            
                            achievementDiv.innerHTML = `
                                <div class="achievement-info">
                                    <div class="achievement-name">${achievement.name}</div>
                                    <div class="achievement-description">${achievement.description}</div>
                                    ${requirementsHTML}
                                    <div class="achievement-meta">
                                        <span><strong>Monster:</strong> ${achievement.monster}</span>
                                        <span><strong>Type:</strong> ${achievement.type}</span>
                                    </div>
                                </div>
                                <div class="achievement-buttons">
                                    <button class="btn btn-todo" 
                                            onclick="setAchievementState('${achievementId}', 'todo')"
                                            ${state === 'todo' ? 'disabled' : ''}>
                                        To Do
                                    </button>
                                    <button class="btn btn-done" 
                                            onclick="setAchievementState('${achievementId}', 'done')"
                                            ${state === 'done' ? 'disabled' : ''}>
                                        Done
                                    </button>
                                    <button class="btn btn-reset" 
                                            onclick="setAchievementState('${achievementId}', 'none')"
                                            ${state === 'none' ? 'disabled' : ''}>
                                        Reset
                                    </button>
                                </div>
                            `;
                            
                            contentDiv.appendChild(achievementDiv);
                        });

                        container.appendChild(categoryDiv);
                    }
                }
            });
        }

        function setAchievementState(achievementId, state) {
            achievementStates[achievementId] = state;
            renderAchievements();
            updateStats();
            saveData(); // Save achievement state changes
        }

        function setAllBossFilters(showAll) {
            Object.keys(bossFilters).forEach(boss => {
                bossFilters[boss] = showAll;
            });
            
            // Update all button appearances
            const buttons = document.querySelectorAll('.boss-btn');
            buttons.forEach(btn => {
                if (showAll) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            renderAchievements();
            updateStats();
            saveData(); // Save filter changes
        }

        function updateStats() {
            let doneCount = 0;
            let currentPoints = 0;
            let totalIncludingTodo = 0;

            Object.keys(achievements).forEach(category => {
                if (achievements[category]) {
                    achievements[category].forEach((achievement, index) => {
                        if (achievement.monster && bossFilters[achievement.monster] !== true) {
                            return;
                        }

                        const achievementId = `${category}-${index}`;
                        const state = achievementStates[achievementId];
                        const points = categoryPoints[category];

                        if (state === 'todo') {
                            totalIncludingTodo += points;
                        } else if (state === 'done') {
                            doneCount++;
                            currentPoints += points;
                            totalIncludingTodo += points;
                        }
                    });
                }
            });

            document.getElementById('currentPoints').textContent = currentPoints;
            document.getElementById('totalIncludingTodo').textContent = totalIncludingTodo;
            
            updateMilestoneStates();
        }
    </script>
</body>
</html>
